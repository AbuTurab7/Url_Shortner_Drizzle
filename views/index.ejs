<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <title>URL Shortener</title>
  </head>
  <body>
    <%- include("./partials/navbar"); %>

    <main class="main-container">
      <div class="container <%= user ? 'islogged' : 'notlogged' %>">
        <section class="hero">
        <h1>ðŸ”— URL Shortener</h1>
      </section>

      <section class="form-card">
        <form action="/shorten" method="POST" class="shorten-form">
          <div class="form-group">
            <label for="url">Enter URL</label>
            <input
              type="url"
              name="url"
              id="url"
              required
              placeholder="https://www.youtube.com"
            />
          </div>

          <div class="form-group">
            <label for="shortCode">Custom Short Code</label>
            <input
              type="text"
              name="shortCode"
              id="shortCode"
              required
              placeholder="youtube123"
            />
          </div>

          <button id="shortenBtn" type="submit" class="btn-primary">
            ðŸš€ Shorten
          </button>
        </form>
      </section>

      <section class="links-card">
        <h2>ðŸ“Œ Recent Shortened URLs</h2>
        <ul id="shortened_urls" class="links-list">
          <% const list = Links %> <% const newList = list.slice(-5).reverse()
          %> <% newList.map(({shortCode, url}) => { %> <% const newURL =
          url.length >= 40 ? url.slice(0, 40) + "..." : url; %>
          <li class="link-item">
            <a href="/<%= shortCode %>" target="_blank">
              <%= host %>/<%= shortCode %>
            </a>
            <div class="link-actions">
              <span class="full-url" title="<%= url %>"><%= newURL %></span>
              <button class="copy-btn" data-url="<%= host %>/<%= shortCode %>">
                ðŸ“‹ Copy
              </button>
            </div>
          </li>
          <% }) %>
        </ul>
      </section>
      </div>
    </main>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const copyButtons = document.querySelectorAll(".copy-btn");

        copyButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const url = btn.getAttribute("data-url");
            navigator.clipboard
              .writeText(url)
              .then(() => {
                btn.textContent = "âœ… Copied!";
                btn.style.backgroundColor = "#10b981"; // green success color

                setTimeout(() => {
                  btn.textContent = "ðŸ“‹ Copy";
                  btn.style.backgroundColor = "#3b82f6";
                }, 1500);
              })
              .catch((err) => {
                alert("Failed to copy: " + err);
              });
          });
        });
      });
    </script>
  </body>
</html>
